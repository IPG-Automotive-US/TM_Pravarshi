# CMRos Node (internal ROS node)

## How to write user code
**User code is marked by `/* USER BEGIN: */` and `/* USER END: */` Tags .** You can use highlight extensions to highlight these two tags.

## Publish LiDAR Data
Related parts if you want to add a LiDAR publisher into the CMRos Node:
- Include related sensors' header files
- Add the sensor struct into the CMNode struct
- Create publisher for the sensor (in CMRosIF_CMNode_Init function)
- Get parameters of the sensor (in CMRosIF_CMNode_TestRun_Start_atBegin function)
- Init job (in CMRosIF_CMNode_TestRun_Start_atBegin function)
- Calculation of the sensor data (in CMRosIF_CMNode_Calc function)
- Publish the sensor message (in CMRosIF_CMNode_Out function)

## Subsribe GPS Data
Related parts if you want to add a GPS subsriber into the CMRos Node:
- Include related sensors' header files
- Add the sensor struct into the CMNode struct
- Create a callback function for sensor msg (at the beginning of the code)
- Create a subsriber for the sensor with the callback function (in CMRosIF_CMNode_Init function)
- Init job (in CMRosIF_CMNode_TestRun_Start_atBegin function)

## Publish raw camera frames
Raw camera frames are not generated by Truckmaker or Carmaker but generated by IPG Movie. Therefore, it can not publish raw camera frames directly from Truckmaker like publishing LiDAR data.
As the right framework shown, I wrote a video data streaming (VDS) client to get raw camera frames from IPG Movie through TCP/IP, then use ROS publishers from CMNode to publish these frames into ROS.

![vds](../../images/vds.png)

### Flowchart of VDS thread with CMNode
The ROS publishers are provided to VDS when creating thread, so that VDS can call ROS publisher inside the thread.

![vds-flow](../../images/vds-client.png)

## Contact
If you have any question, contact Jianing Lin at Jianing.Lin@isza.com.


